/*! tswcalc 2013-05-13 */
function renderContainer(){dust.render("container",template_data,function(t,e){t&&console.log(t),$(".container").html(e)})}function startHandlers(){for(var t=0;template_data.slots.length>t;t++){var e=new ButtonHandler(template_data.slots[t].id_prefix);e.initiate();var i=new SelectHandler(template_data.slots[t].id_prefix);i.initiate()}}function updatePrimaryStats(){sumHitPoints=0,sumAttackRating=0,sumHealRating=0;for(var t=0;template_data.slots.length>t;t++){var e=$("#"+template_data.slots[t].id_prefix+"-role option:selected").attr("value"),i=$("#"+template_data.slots[t].id_prefix+"-ql option:selected").attr("value");"dps"==e?sumAttackRating+=custom_gear_data[template_data.slots[t].group].heal_dps["ql"+i].rating:"healer"==e?sumHealRating+=custom_gear_data[template_data.slots[t].group].heal_dps["ql"+i].rating:"tank"==e&&(sumHitPoints+=custom_gear_data[template_data.slots[t].group].tank["ql"+i].hitpoints)}$("#stat-hitpoints").text(sumHitPoints),$("#stat-attack-rating").text(sumAttackRating),$("#stat-heal-rating").text(sumHealRating)}function updateOffensiveDefensiveStats(){sums={"critical-rating":0,"critical-power":0,"penetration-rating":0,"hit-rating":0,"block-rating":0,"defense-rating":0,"evade-rating":0,"physical-protection":0,"magical-protection":0};for(var t=0;template_data.slots.length>t;t++){var e=$("#"+template_data.slots[t].id_prefix+"-glyph-ql option:selected").attr("value"),i=$("#"+template_data.slots[t].id_prefix+"-primary-glyph option:selected").attr("value"),a=$("#"+template_data.slots[t].id_prefix+"-secondary-glyph option:selected").attr("value");if("none"!=i||"none"!=a){var n=$("#"+template_data.slots[t].id_prefix+"-primary-glyph-dist > button.btn.active")[0].innerHTML,s=$("#"+template_data.slots[t].id_prefix+"-secondary-glyph-dist > button.btn.active")[0].innerHTML;if(null!=n||null!=s){var r=0,o=0;"none"!=i&&(r=glyph_data.stat[i].ql[e].slot[template_data.slots[t].group].dist[n],sums[i]+=r,$("#"+template_data.slots[t].id_prefix+"-primary-glyph-value").html("+"+r)),"none"!=a&&(o=glyph_data.stat[a].ql[e].slot[template_data.slots[t].group].dist[s],sums[a]+=o,$("#"+template_data.slots[t].id_prefix+"-secondary-glyph-value").html("+"+o))}}}console.log(sums);for(var l in sums)sums.hasOwnProperty(l)&&(sums[l]>0?$("#stat-"+l).html("+"+sums[l]):$("#stat-"+l).html("0"))}function SelectHandler(t){var t=t,e=this;this.initiate=function(){e.addListenersToRoleSelect(t),e.addListenersToQlSelect(t,""),e.addListenersToGlyphSelect(t,"glyph-ql"),e.addListenersToGlyphSelect(t,"primary-glyph"),e.addListenersToGlyphSelect(t,"secondary-glyph")},this.addListenersToRoleSelect=function(t){$("#"+t+"-role").change(function(){updatePrimaryStats()})},this.addListenersToQlSelect=function(t,e){$("#"+t+e+"-ql").change(function(){updatePrimaryStats()})},this.addListenersToGlyphSelect=function(t,e){$("#"+t+"-"+e).change(function(){updateOffensiveDefensiveStats()})}}function ButtonHandler(t){var t=t,e=this;this.initiate=function(){this.addListenersToGlyphDistButtons(t,"primary-glyph"),this.addListenersToGlyphDistButtons(t,"secondary-glyph")},this.addListenersToGlyphDistButtons=function(i,a){e.onlyActiveButton("#"+t+"-primary-glyph-dist-btn0"),e.onlyActiveButton("#"+t+"-secondary-glyph-dist-btn0"),buttons=$("#"+i+"-"+a+"-dist > button.btn").on("click",function(){e.onlyActiveButton("#"+this.id),e.balanceGlyphDist(this,a),updateOffensiveDefensiveStats()})},this.balanceGlyphDist=function(i,a){otherActiveButton=$("#"+t+"-"+e.getInverseGlyphStat(a)+"-dist > button.btn.active"),e.balanceGlyphDistOverflow(i,otherActiveButton[0])},this.balanceGlyphDistOverflow=function(t,i){null!=i&&(clickedDist=parseInt(t.innerHTML),otherDist=parseInt(i.innerHTML),sumBothDist=clickedDist+otherDist,sumBothDist>4&&(otherDistLoweredByOne=i.id.substring(0,i.id.length-1)+(otherDist-(sumBothDist-4)),e.onlyActiveButton("#"+otherDistLoweredByOne)))},this.onlyActiveButton=function(t){$(t).siblings().removeClass("active"),$(t).siblings().removeClass("btn-success"),$(t).addClass("active"),$(t).addClass("btn-success")},this.getInverseGlyphStat=function(t){return"primary-glyph"==t?"secondary-glyph":"primary-glyph"}}(function(){function t(t,e){return t.write('      <div class="masthead"><ul class="nav nav-pills pull-right"><li class="active"><a href="#">Calculator</a></li><li><a href="https://github.com/joakibj/tswcalc">Github</a></li></ul><h3 class="muted">tswcalc</h3></div><hr><div class="row-fluid"><div class="span8">').partial("slots",e,null).write('</div><div class="span4">').partial("summary",e,null).write('</div></div><hr><div class="footer"><p>&copy; tswcalc</p></div>')}return dust.register("container",t),t})(),function(){function t(t,e){return t.write('<div id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist" class="btn-group glyphbuttons"><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn0" class="btn btn-mini btn-danger">0</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn1" class="btn btn-mini btn-danger">1</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn2" class="btn btn-mini btn-danger">2</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn3" class="btn btn-mini btn-danger">3</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn4" class="btn btn-mini btn-danger">4</button></div>')}return dust.register("glyphbuttons",t),t}(),function(){function t(t,e){return t.write('<select id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-ql" class="select-ql"><option value="10.0">10.0</option><option value="10.1">10.1</option><option value="10.2">10.2</option><option value="10.3">10.3</option><option value="10.4">10.4</option><option value="10.5">10.5</option></select>')}return dust.register("qlselect",t),t}(),function(){function t(t,a){return t.section(a.get("slots"),a,{"else":e,block:i},null)}function e(t){return t.write("<p>No slots found (Bug)!</p>")}function i(t,e){return t.write('<div id="').reference(e.get("id_prefix"),e,"h").write('-slot" class="slot"><h4 class="slot">').reference(e.get("name"),e,"h").write('</h4> <table class="table table-slots">').notexists(e.get("is_weapon"),e,{block:a},null).write("<tr><td><strong>QL:</strong></td><td>").partial("qlselect",e,{id_suffix:""}).write('</td></tr></table><div><table id="').reference(e.get("id_prefix"),e,"h").write('-glyphs" class="table table-glyphs"><tr><td><strong>Glyph QL</strong></td><td>').partial("qlselect",e,{id_suffix:"-glyph"}).write('</td></tr><tr><td>Glyph Primary Stat</td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-primary-glyph" class="select-glyph"><option value="none" selected="true">None</option><option value="critical-rating">Critical Rating</option><option value="critical-power">Critical Power</option><option value="penetration-rating">Penetration Rating</option><option value="hit-rating">Hit Rating</option><option value="block-rating">Block Rating</option><option value="defense-rating">Defense Rating</option><option value="evade-rating">Evade Rating</option><option value="physical-protection">Physical Protection</option><option value="magical-protection">Magical Protection</option></select></td><td><strong>Distribution:</strong> ').partial("glyphbuttons",e,{id_suffix:"-primary-glyph"}).write('</td><td id="').reference(e.get("id_prefix"),e,"h").write('-primary-glyph-value" class="statvalue">0</td></tr><tr><td>Glyph Secondary Stat</td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-secondary-glyph" class="select-glyph"><option value="none" selected="true">None</option><option value="critical-rating">Critical Rating</option><option value="critical-power">Critical Power</option><option value="penetration-rating">Penetration Rating</option><option value="hit-rating">Hit Rating</option><option value="block-rating">Block Rating</option><option value="defense-rating">Defense Rating</option><option value="evade-rating">Evade Rating</option><option value="physical-protection">Physical Protection</option><option value="magical-protection">Magical Protection</option></select></td><td><strong>Distribution:</strong> ').partial("glyphbuttons",e,{id_suffix:"-secondary-glyph"}).write('</td><td id="').reference(e.get("id_prefix"),e,"h").write('-secondary-glyph-value" class="statvalue">0</td></tr></table></div></div>  ')}function a(t,e){return t.write('<tr><td><strong>Role: </strong></td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-role" class="select-role"><option value="none" selected="true">None</option><option value="dps">DPS</option><option value="tank">Tank</option><option value="healer">Healer</option></select></td></tr>')}return dust.register("slots",t),t}(),function(){function t(t){return t.write('        <div id="summary"><h4>Summary</h4><div id="table-primary"><table class="table table-stats"><thead><th>Primary Stat</th><th>Value</th></thead><tbody><tr><td>Hitpoints</td><td id="stat-hitpoints" class="statvalue">0</td></tr><tr><td>Attack Rating</td><td id="stat-attack-rating" class="statvalue">0</td></tr><tr><td>Heal Rating</td><td id="stat-heal-rating" class="statvalue">0</td></tr></tbody></table></div><hr/><div id="table-offensive"><table class="table table-stats"><thead><th>Offensive Stat</th><th>Value</th></thead><tbody><tr><td>Critical Rating</td><td id="stat-critical-rating" class="statvalue">0</td></tr><tr><td>Critical Power</td><td id="stat-critical-power" class="statvalue">0</td></tr><tr><td>Penetration Rating</td><td id="stat-penetration-rating" class="statvalue">0</td></tr><tr><td>Hit Rating</td><td id="stat-hit-rating" class="statvalue">0</td></tr></tbody></table></div><hr/><div id="table-defensive"><table class="table table-stats"><thead><th>Defensive Stat</th><th>Value</th></thead><tbody><tr><td>Block Rating</td><td id="stat-block-rating" class="statvalue">0</td></tr><tr><td>Defense Rating</td><td id="stat-defense-rating" class="statvalue">0</td></tr><tr><td>Evade Rating</td><td id="stat-evade-rating" class="statvalue">0</td></tr><tr><td>Physical Protection</td><td id="stat-physical-protection" class="statvalue">0</td></tr><tr><td>Magical Protection</td><td id="stat-magical-protection" class="statvalue">0</td></tr></tbody></table></div></div>')}return dust.register("summary",t),t}(),$(document).ready(function(){renderContainer(template_data),startHandlers(),$("#summary").scrollToFixed()});