/*! tswcalc version 1.1.1 2013-06-21 */
function initiateTswCalc(){renderContainer(template_data),addHash(),activateToolTips(),startSubModules(),checkIfExported()||triggerReset(),$("#summary").scrollToFixed()}function triggerReset(){$("#btn-reset").trigger("click")}function activateToolTips(){$(".glyph-tooltip, .signet-tooltip").tooltip({placement:"left"}),$(".cost-tooltip").tooltip({placement:function(t,e){var i=$(e).position();return 50>i.top?"bottom":"top"}}),$("#raid-stats > label").tooltip({placement:"bottom"}),$(".cost-tooltip, .glyph-tooltip, .signet-tooltip").on("click",function(t){t.preventDefault(),t.stopPropagation()})}function renderContainer(){dust.render("container",{slots:template_data.slots,signets:signet_data},function(t,e){t&&console.log(t),$(".container").html(e)})}function checkIfExported(){var t=$.getUrlVars();return!$.isEmptyObject(t)&&8==Object.keys(t).length||10==Object.keys(t).length?(importModule.start(t),!0):!1}function startSubModules(){slots.init();for(var t=0;template_data.slots.length>t;t++)startDistributionButtonHandler(template_data.slots[t].id_prefix),startSelectHandler(template_data.slots[t]),startRaidCheckboxes(template_data.slots[t].id_prefix);startButtonBar(),startSummary(),startExportModule(),startImportModule()}function addHash(){""==location.hash&&(location.hash=" ")}function startDistributionButtonHandler(t){buttonHandler[t]=new DistributionButtonHandler(t),buttonHandler[t].initiate()}function startSelectHandler(t){selectHandler[t.id_prefix]=new SelectHandler(t),selectHandler[t.id_prefix].initiate()}function startRaidCheckboxes(t){raidCheckboxes[t]=new RaidCheckbox(t),raidCheckboxes[t].initiate()}function startButtonBar(){buttonBar=new ButtonBar,buttonBar.initiate()}function startSummary(){summary=new Summary,summary.initiate()}function startExportModule(){exportModule=new Export,exportModule.initiate()}function startImportModule(){importModule=new Import}function Summary(){self=this,this.el={black_bullion_cost:$("#bb-cost"),criterion_upgrade_cost:$("#cu-cost"),astral_fuse_cost:$("#af-cost"),activateRaid:$("#summary-activate-raid")},this.initiate=function(){this.bindEvents()},this.bindEvents=function(){this.el.activateRaid.on("change",this.activateRaidItems)},this.activateRaidItems=function(){self.updateAllStats()},this.updateAllStats=function(){self.updateCosts(),self.updatePrimaryStats(),self.updateOffensiveDefensiveStats()},this.collectAllStats=function(){return{primary:self.collectPrimaryStats(),offensive_defensive:self.collectOffensiveDefensiveStats()}},this.updateCosts=function(){var t=0,e=0,i=0;for(var n in slots)if(slots.hasSlot(n)){var s=slots[n];t+=s.blackBullionCost(),e+=s.criterionUpgradeCost(),i+=s.astralFuseCost()}this.el.black_bullion_cost.html(t),this.el.criterion_upgrade_cost.html(e),this.el.astral_fuse_cost.html(i)},this.updatePrimaryStats=function(){var t=this.collectPrimaryStats();for(var e in t)t.hasOwnProperty(e)&&this.updateOnePrimaryStat(e,t[e]);this.updateCosts()},this.updateOnePrimaryStat=function(t,e){$("#stat-"+t).text(e)},this.collectPrimaryStats=function(){var t={"combat-power":0,"weapon-power":75,hitpoints:1970,"attack-rating":0,"heal-rating":0};for(var e in slots)if(slots.hasSlot(e)){var i=slots[e],n=i.role(),s=i.ql();if("major"==i.group){var a=i.signet();0!==a.id&&80>a.id&&(t[a.stat]+=i.determineSignetQualityValue(a))}switch(n){case"dps":t["attack-rating"]+=custom_gear_data[i.group].heal_dps["ql"+s].rating;break;case"healer":t["heal-rating"]+=custom_gear_data[i.group].heal_dps["ql"+s].rating;break;case"tank":t.hitpoints+=custom_gear_data[i.group].tank["ql"+s].hitpoints;break;case"none":"weapon"==i.id&&(t["weapon-power"]=custom_gear_data[i.group][s].weapon_power);break;default:console.log("Illegal role value when collecting primary stats")}}return t["combat-power"]=this.calculateCombatPower(t["attack-rating"],t["weapon-power"]),t},this.calculateCombatPower=function(t,e){return Math.round((375-600/(Math.pow(Math.E,t/1400)+1))*(1+e/375))},this.updateOffensiveDefensiveStats=function(){var t=this.collectOffensiveDefensiveStats();this.updateGlyphValues(),this.updateStats(t),this.updateCosts()},this.collectOffensiveDefensiveStats=function(){var t={"critical-rating":0,"critical-chance":0,"critical-power":0,"critical-power-percentage":0,"penetration-rating":0,"hit-rating":0,"block-rating":0,"defense-rating":0,"evade-rating":0,"physical-protection":249,"magical-protection":249};for(var e in slots)if(slots.hasSlot(e)){var i=slots[e];t[i.primaryGlyph()]+=i.primaryGlyphValue(),t[i.secondaryGlyph()]+=i.secondaryGlyphValue()}t["critical-power-percentage"]=this.calculateCriticalPowerPercentage(t["critical-power"]);for(var e in slots)if(slots.hasSlot(e)){var i=slots[e];if(this.el.activateRaid.is(":checked")&&i.signetId()>=80){var n=i.signet();if(void 0!==n.bonus)for(var s=0;n.bonus.stat.length>s;s++)void 0!==n.bonus.add?t[n.bonus.stat[s]]+=n.bonus.add:void 0!==n.bonus.multiply&&(t[n.bonus.stat[s]]=void 0!==n.stack_max?(1+n.bonus.multiply*n.stack_max)*t[n.bonus.stat[s]]:n.bonus.multiply*t[n.bonus.stat[s]])}}return t["critical-chance"]=this.calculateCriticalChance(t["critical-rating"]),t["critical-rating"]=parseInt(t["critical-rating"].toFixed(0),10),t["critical-chance"]=t["critical-chance"].toFixed(2),t["critical-power-percentage"]=t["critical-power-percentage"].toFixed(2),t["penetration-rating"]=parseInt(t["penetration-rating"].toFixed(0),10),t["magical-protection"]=parseInt(t["magical-protection"].toFixed(0),10),t["physical-protection"]=parseInt(t["physical-protection"].toFixed(0),10),t},this.updateGlyphValues=function(){for(var t in slots)if(slots.hasSlot(t)){var e=slots[t];e.updateGlyphValues()}},this.calculateCriticalChance=function(t){return 39-68/(Math.pow(Math.E,t/787.6)+1)},this.calculateCriticalPowerPercentage=function(t){return Math.sqrt(5*t+625)},this.updateStats=function(t){for(var e in t)t.hasOwnProperty(e)&&(t[e]>0?$("#stat-"+e).html(this.isStatPercentageBased(e)?(""+t[e]).substring(0,4)+" %":"+"+t[e]):$("#stat-"+e).html(this.isStatPercentageBased(e)?"0 %":"0"))},this.isStatPercentageBased=function(t){return"critical-power-percentage"==t||"critical-chance"==t}}function SelectHandler(t){this.initiate=function(){this.bindEvents(),this.addSignetsToSelect()},this.bindEvents=function(){slots[t.id_prefix].el.role.change(this.roleChange),slots[t.id_prefix].el.ql.change(this.qlChange),slots[t.id_prefix].el.glyphQl.change(this.glyphChange),slots[t.id_prefix].el.primaryGlyph.change(this.glyphChange),slots[t.id_prefix].el.secondaryGlyph.change(this.glyphChange),slots[t.id_prefix].el.signetId.change(this.signetChange),slots[t.id_prefix].el.signetQuality.change(this.signetChange)},this.addSignetsToSelect=function(){slots[t.id_prefix].el.signetId.append($("<option>",{value:"none",text:"None",selected:"true"})),this.updateToDefaultSignet();var e=$.merge([],signet_data[t.group]);$.merge(e,this.getSignetsForHead(t.group)),e.sort(function(t,e){return t.name.toLowerCase()>e.name.toLowerCase()?1:-1}),$.each(e,function(e,i){slots[t.id_prefix].el.signetId.append($("<option>",{value:i.id,text:i.name}))})},this.updateToDefaultSignet=function(){var e="assets/images/icons/"+t.group+"_dps.png",i="assets/images/icons/normal.png";$("#"+t.id_prefix+"-signet-img-icon").attr("src",e),$("#"+t.id_prefix+"-signet-img-quality").attr("src",i)},this.getSignetsForHead=function(t){return"head"==t?signet_data.weapon:[]},this.signetChange=function(){slots[t.id_prefix].updateSignet(),summary.updatePrimaryStats()},this.roleChange=function(){var e=$(this).val();void 0===ny_raid_items[t.id_prefix][e]?(slots[t.id_prefix].el.btn.nyraid.attr("checked",!1),slots[t.id_prefix].el.btn.nyraid.attr("disabled","disabled")):slots[t.id_prefix].el.btn.nyraid.removeAttr("disabled"),slots[t.id_prefix].el.btn.nyraid.is(":checked")?raidCheckboxes[t.id_prefix].changeToRaidItem():raidCheckboxes[t.id_prefix].changeToCustomItem(),summary.updatePrimaryStats()},this.qlChange=function(){summary.updatePrimaryStats()},this.glyphChange=function(){summary.updateOffensiveDefensiveStats()}}function DistributionButtonHandler(t){var t=t,e=this;this.initiate=function(){this.addListenersToGlyphDistButtons("primary"),this.addListenersToGlyphDistButtons("secondary")},this.addListenersToGlyphDistButtons=function(i){this.onlyActiveButton("#"+t+"-"+i+"-glyph-dist-btn0"),$("#"+t+"-"+i+"-glyph-dist > button.btn").on("click",function(){e.setActiveButtonAndBalanceGlyphDist(this,i),summary.updateOffensiveDefensiveStats()})},this.setActiveButtonAndBalanceGlyphDist=function(t,e){this.onlyActiveButton("#"+t.id),this.balanceGlyphDist(t,e)},this.balanceGlyphDist=function(t,i){otherActiveButton=e.getActiveDist(e.getInverseGlyphStat(i)),this.balanceGlyphDistOverflow(t,otherActiveButton)},this.getActiveDist=function(e){return $("#"+t+"-"+e+"-glyph-dist > button.btn.active")[0]},this.balanceGlyphDistOverflow=function(t,i){if(null!==i){var n=parseInt(t.innerHTML,10),s=parseInt(i.innerHTML,10),a=n+s;if(a>4){var r=i.id.substring(0,i.id.length-1)+(s-(a-4));e.onlyActiveButton("#"+r)}}},this.onlyActiveButton=function(t){$(t).siblings().removeClass("active"),$(t).siblings().removeClass("btn-success"),$(t).addClass("active"),$(t).addClass("btn-success")},this.getInverseGlyphStat=function(t){return"primary"==t?"secondary":"primary"}}function ButtonBar(){this.el={btn_all_dps:$("#btn-all-dps"),btn_all_healer:$("#btn-all-healer"),btn_all_tank:$("#btn-all-tank"),btn_all_10_4:$("#btn-all-10-4"),btn_all_10_5:$("#btn-all-10-5"),btn_reset:$("#btn-reset")},this.initiate=function(){this.bindEvents()},this.bindEvents=function(){this.el.btn_all_dps.on("click",this.setRoleOnAllSlots),this.el.btn_all_healer.on("click",this.setRoleOnAllSlots),this.el.btn_all_tank.on("click",this.setRoleOnAllSlots),this.el.btn_all_10_4.on("click",this.setQlOnAllSlots),this.el.btn_all_10_5.on("click",this.setQlOnAllSlots),this.el.btn_reset.on("click",this.resetAllSlots)},this.setRoleOnAllSlots=function(t){var e=t.target.id.split("-")[2];for(var i in slots)slots.hasSlot(i)&&(slots[i].role(e),"weapon"!=i&&void 0===ny_raid_items[i][e]?(slots[i].el.btn.nyraid.prop("checked",!1),slots[i].el.btn.nyraid.change(),slots[i].el.btn.nyraid.attr("disabled","disabled")):slots[i].el.btn.nyraid.removeAttr("disabled"));summary.updateAllStats()},this.setQlOnAllSlots=function(t){var e="10."+t.target.id.split("-")[3];for(var i in slots)slots.hasSlot(i)&&(slots[i].el.btn.nyraid.is(":checked")||slots[i].ql(e),slots[i].glyphQl(e),slots[i].el.btn.primary[4].trigger("click"));summary.updateAllStats()},this.resetAllSlots=function(){slots.reset(),summary.updateAllStats()}}function Export(){var t=this;this.exportType=0,this.slotState={},this.el={export_btn:$("a.export"),export_textarea:$("#export-textarea"),open_export_modal:$("#open-export-modal")},this.initiate=function(){this.bindEvents()},this.bindEvents=function(){this.el.export_btn.on("click",function(e){t.exportType=$(e.target).attr("data"),t.startExport()}),this.el.open_export_modal.on("shown",function(){t.el.export_textarea.focus()}),this.el.export_textarea.focus(function(){$(this).select(),$(this).mouseup(function(){return $(this).unbind("mouseup"),!1})})},this.startExport=function(){"url"==this.exportType?this.startExportUrl():"bbcode"==this.exportType&&this.startExportBBCode()},this.startExportUrl=function(){this.collectAllSlotStates(),url=this.createExportUrl(),this.el.export_textarea.attr("rows","1"),this.el.export_textarea.html(location.origin+location.pathname+"#"+url)},this.createExportUrl=function(){var t="",e=0;for(var i in slots)if(slots.hasSlot(i)){var n=slots[i];t+=this.createSlotUrl(n.id,this.slotState[n.id]),slots.length()-1>e&&(t+="&"),e++}return t},this.createSlotUrl=function(t,e){return t+"="+e.ql+","+e.role+","+e.glyph_ql+","+e.primary_glyph+","+e.secondary_glyph+","+e.primary_dist+","+e.secondary_dist+","+e.signet_quality+","+e.signet_id},this.startExportBBCode=function(){this.collectAllSlotStates(),dust.render("export\bbcode",{slotState:this.dustSlotState(),summary:summary.collectAllStats()},function(e,i){e&&console.log(e),t.el.export_textarea.attr("rows","10"),t.el.export_textarea.html(i)})},this.dustSlotState=function(){for(var t=[],e=0;template_data.slots.length>e;e++){var i=template_data.slots[e].id_prefix,n=template_data.slots[e].group,s=this.slotState[i],a=role_mapping.to_stat[s.role],r=slots[i].primaryGlyphValue(),l=slots[i].secondaryGlyphValue(),o=0,c=0;"healer"==a?(o="Heal Rating",c=custom_gear_data[n].heal_dps["ql10."+s.ql].rating):"dps"==a?(o="Attack Rating",c=custom_gear_data[n].heal_dps["ql10."+s.ql].rating):"tank"==a?(o="Hitpoints",c=custom_gear_data[n].tank["ql10."+s.ql].hitpoints):template_data.slots[e].is_weapon&&(o="Weapon Power",c=custom_gear_data[n]["10."+s.ql].weapon_power);var d=slots[i].signet(),p={name:capitalise(i),role:blankIfNone(capitalise(a)),ql:s.ql,stat_type:o,stat_value:c,glyph_ql:s.glyph_ql,primary_glyph:blankIfNone(capitalise(stat_mapping.to_stat[s.primary_glyph])),primary_dist:s.primary_dist,primary_value:r,secondary_glyph:blankIfNone(capitalise(stat_mapping.to_stat[s.secondary_glyph])),secondary_dist:s.secondary_dist,secondary_value:l,signet_name:d.name,signet_quality:blankIfNone(capitalise(signet_quality_mapping.to_name[s.signet_quality])),signet_description:slots[i].signetDescription(),signet_colour:signet_quality_mapping.to_colour[signet_quality_mapping.to_name[s.signet_quality]],is_item:d.id>=80?!0:!1};t.push(p)}return t},this.collectAllSlotStates=function(){this.slotState=slots.mappedState()}}function Import(){this.start=function(t){for(var e in t)t.hasOwnProperty(e)&&(splitVars=t[e].split(","),this.updateSlot(e,splitVars));summary.updateAllStats()},this.updateSlot=function(t,e){slots[t].ql("10."+e[0]),slots[t].role(role_mapping.to_stat[e[1]]),slots[t].glyphQl("10."+e[2]),slots[t].primaryGlyph(stat_mapping.to_stat[e[3]]),slots[t].secondaryGlyph(stat_mapping.to_stat[e[4]]),slots[t].el.btn.primary[e[5]].click(),slots[t].el.btn.secondary[e[6]].click(),void 0!==typeof e[7]&&void 0!==typeof e[8]&&(e[8]>=80?(slots[t].el.btn.nyraid.prop("disabled",!1),slots[t].el.btn.nyraid.prop("checked",!0),slots[t].el.btn.nyraid.change()):(slots[t].isWeapon()||void 0===ny_raid_items[t][slots[t].role()]||slots[t].el.btn.nyraid.prop("disabled",!1),slots[t].signetQuality(signet_quality_mapping.to_name[e[7]]),slots[t].signetId("0"!=e[8]?e[8]:"none"),slots[t].el.signetId.change()))}}function capitalise(t){return t.charAt(0).toUpperCase()+t.slice(1)}function blankIfNone(t){return"None"==t||"none"==t?"":t}function Slot(t,e,i){this.id=t,this.name=e,this.group=i,this.el={name:$("#"+this.id+"-name"),role:$("#"+this.id+"-role"),ql:$("#"+this.id+"-ql"),glyphQl:$("#"+this.id+"-glyph-ql"),primaryGlyph:$("#"+this.id+"-primary-glyph"),secondaryGlyph:$("#"+this.id+"-secondary-glyph"),primaryDist:"#"+this.id+"-primary-glyph-dist > button.btn.active",secondaryDist:"#"+this.id+"-secondary-glyph-dist > button.btn.active",primaryGlyphValue:$("#"+this.id+"-primary-glyph-value"),secondaryGlyphValue:$("#"+this.id+"-secondary-glyph-value"),signetId:$("#"+this.id+"-pick-signet"),signetQuality:$("#"+this.id+"-signet-quality"),signetIconImg:$("#"+this.id+"-signet-img-icon"),signetIconBorderImg:$("#"+this.id+"-signet-img-quality"),signetDescription:$("#"+this.id+"-signet-description"),btn:{primary:{0:$("#"+this.id+"-primary-glyph-dist-btn0"),1:$("#"+this.id+"-primary-glyph-dist-btn1"),2:$("#"+this.id+"-primary-glyph-dist-btn2"),3:$("#"+this.id+"-primary-glyph-dist-btn3"),4:$("#"+this.id+"-primary-glyph-dist-btn4")},secondary:{0:$("#"+this.id+"-secondary-glyph-dist-btn0"),1:$("#"+this.id+"-secondary-glyph-dist-btn1"),2:$("#"+this.id+"-secondary-glyph-dist-btn2"),3:$("#"+this.id+"-secondary-glyph-dist-btn3"),4:$("#"+this.id+"-secondary-glyph-dist-btn4")},nyraid:$("#"+this.id+"-nyraid")}},this.name=function(){return 1!=arguments.length?this.el.name.html():(this.el.name.html(arguments[0]),void 0)},this.isWeapon=function(){return"weapon"==this.group?!0:!1},this.role=function(){return 1!=arguments.length?"weapon"!=this.group?this.el.role.val():"none":(this.el.role.val(arguments[0]),void 0)},this.ql=function(){return 1!=arguments.length?this.el.ql.val():(this.el.ql.val(arguments[0]),void 0)},this.glyphQl=function(){return 1!=arguments.length?this.el.glyphQl.val():(this.el.glyphQl.val(arguments[0]),void 0)},this.primaryGlyph=function(){return 1!=arguments.length?this.el.primaryGlyph.val():(this.el.primaryGlyph.val(arguments[0]),void 0)},this.secondaryGlyph=function(){return 1!=arguments.length?this.el.secondaryGlyph.val():(this.el.secondaryGlyph.val(arguments[0]),void 0)},this.primaryGlyphValue=function(){return"none"==this.primaryGlyph()?0:glyph_data.stat[this.primaryGlyph()].ql[this.glyphQl()].slot[this.group].dist[this.primaryDist()]},this.secondaryGlyphValue=function(){return"none"==this.secondaryGlyph()?0:glyph_data.stat[this.secondaryGlyph()].ql[this.glyphQl()].slot[this.group].dist[this.secondaryDist()]},this.primaryDist=function(){return $(this.el.primaryDist)[0].innerHTML},this.secondaryDist=function(){return $(this.el.secondaryDist)[0].innerHTML},this.blackBullionCost=function(){var t=0;return t+=bb_costs.glyph[this.glyphQl()].cost,t+=bb_costs[this.isWeapon()?"weapon":"talisman"][this.ql()].cost},this.astralFuseCost=function(){return"10.5"==this.glyphQl()?1:0},this.criterionUpgradeCost=function(){return"10.5"==this.ql()?1:0},this.signetId=function(){return 1!=arguments.length?this.el.signetId.val():(this.el.signetId.val(arguments[0]),void 0)},this.signetQuality=function(){return 1!=arguments.length?this.el.signetQuality.val():(this.el.signetQuality.val(arguments[0]),void 0)},this.signet=function(){var t=0;return t=this.signetId()>=80?ny_raid_items[this.id][this.role()].signet:signet_data.find(this.group,this.signetId()),0!==t||void 0!==t?t:null},this.signetDescription=function(){var t=this.signet();if(null===t)return"";var e="";return e=t.description.replace("%s",this.determineSignetQualityValue(t)),e=e.replace("%d",this.determineSignetQualityValue(t)),"[object Array]"===Object.prototype.toString.call(t.quality)&&(e=e.replace("%0",this.determineSignetQualityValue(t,0)),e=e.replace("%1",this.determineSignetQualityValue(t,1))),"0"!=t.cooldown&&(e+=" "+t.cooldown+" seconds cooldown."),e},this.determineSignetQualityValue=function(t,e){e=e!==void 0?e:-1;var i=this.signetQuality();switch(i){case"none":return 0;case"normal":return-1==e?t.quality.normal:t.quality[e].normal;case"elite":return-1==e?t.quality.elite:t.quality[e].elite;case"epic":return-1==e?t.quality.epic:t.quality[e].epic;default:return 0}},this.updateGlyphValues=function(){this.updatePrimaryGlyphValue(),this.updateSecondaryGlyphValue()},this.updatePrimaryGlyphValue=function(){this.el.primaryGlyphValue.html(0!==this.primaryGlyphValue()?"+"+this.primaryGlyphValue():0)},this.updateSecondaryGlyphValue=function(){this.el.secondaryGlyphValue.html(0!==this.secondaryGlyphValue()?"+"+this.secondaryGlyphValue():0)},this.updateSignet=function(){this.updateSignetIcon(),this.updateSignetDescription()},this.updateSignetIcon=function(){var t=this.signet(),e=this.signetQuality();0!==t.id&&"none"!=e?(this.updateSignetIconBorder(e),this.updateSignetIconImage(t)):0!==t.id&&"none"==e?this.signetQuality("normal"):"none"!=e&&0===t.id?(this.updateSignetIconBorder(e),this.updateSignetIconImageFromName(this.group+"_dps")):(this.updateSignetIconBorder("normal"),this.updateSignetIconImageFromName(this.group+"_dps"))},this.updateSignetIconBorder=function(t){var e="assets/images/icons/"+t+".png";this.el.signetIconBorderImg.attr("src",e)},this.updateSignetIconImage=function(t){this.updateSignetIconImageFromName(t.icon)},this.updateSignetIconImageFromName=function(t){var e="assets/images/icons/"+t+".png";this.el.signetIconImg.attr("src",e)},this.updateSignetDescription=function(){this.el.signetDescription.html(this.signetDescription())},this.reset=function(){this.ql("10.0"),this.role("none"),this.glyphQl("10.0"),this.primaryGlyph("none"),this.secondaryGlyph("none"),this.el.btn.primary[0].trigger("click"),this.el.btn.secondary[0].trigger("click"),this.signetId("none"),this.signetQuality("none"),this.updateSignet(),this.el.btn.nyraid.is(":checked")&&(this.el.btn.nyraid.prop("checked",!1),this.el.btn.nyraid.change())},this.state=function(){return{role:this.role(),ql:this.ql(),glyph_ql:this.glyphQl(),primary_glyph:this.primaryGlyph(),secondary_glyph:this.secondaryGlyph(),primary_dist:this.primaryDist(),secondary_dist:this.secondaryDist(),signet_quality:this.signetQuality(),signet_id:this.signetId()}},this.mappedState=function(){return{role:this.stripContent(this.role()),ql:this.stripContent(this.ql()),glyph_ql:this.stripContent(this.glyphQl()),primary_glyph:this.stripContent(this.primaryGlyph()),secondary_glyph:this.stripContent(this.secondaryGlyph()),primary_dist:this.primaryDist(),secondary_dist:this.secondaryDist(),signet_quality:this.stripContent(this.signetQuality()),signet_id:this.stripContent(this.signetId())}},this.stripContent=function(t){(null==t||"none"==t)&&(t=0);var e=/\d+\.\d/;return 0!=t&&t.match(e)?t.split(".")[1]:-1!=$.inArray(t,Object.keys(stat_mapping.to_num))?stat_mapping.to_num[t]:-1!=$.inArray(t,Object.keys(role_mapping.to_num))?role_mapping.to_num[t]:-1!=$.inArray(t,Object.keys(signet_quality_mapping.to_num))?signet_quality_mapping.to_num[t]:t}}function RaidCheckbox(t){var e=this;this.initiate=function(){"weapon"!=t&&this.bindEvents()},this.bindEvents=function(){slots[t].el.btn.nyraid.on("change",this.checkboxClicked)},this.checkboxClicked=function(){$(this).is(":checked")?e.changeToRaidItem():e.changeToCustomItem()},this.changeToRaidItem=function(){var e=ny_raid_items[t][slots[t].role()];void 0!==e&&(slots[t].name(": "+e.name),slots[t].ql("10.4"),slots[t].signetQuality("epic"),slots[t].el.signetId.append($("<option>",{value:e.signet.id,text:e.signet.name,selected:!0})),slots[t].updateSignet(),slots[t].el.ql.attr("disabled","disabled"),slots[t].el.signetId.attr("disabled","disabled"),slots[t].el.signetQuality.attr("disabled","disabled"),summary.updateAllStats())},this.changeToCustomItem=function(){slots[t].el.ql.removeAttr("disabled"),slots[t].el.signetId.removeAttr("disabled"),slots[t].el.signetQuality.removeAttr("disabled"),slots[t].el.signetId.find("option").filter(function(){return $(this).attr("value")>=80}).remove(),slots[t].name(""),slots[t].ql("10.0"),slots[t].signetQuality("none"),slots[t].signetId("none"),slots[t].updateSignet(),summary.updateAllStats()}}(function(){function t(t){return t.write('<div class="btn-group"><button id="btn-reset" class="btn btn-danger">Reset</button></div><div class="btn-group"><button id="btn-all-dps" class="btn">All DPS</button><button id="btn-all-healer" class="btn">All Healer</button><button id="btn-all-tank" class="btn">All Tank</button></div><div class="btn-group"><button id="btn-all-10-4" class="btn">All 10.4</button><button id="btn-all-10-5" class="btn">All 10.5</button></div><div class="btn-group"><a class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="#">Export<span class="caret"></span></a><ul class="dropdown-menu"><li><a class="export" href="#open-export-modal" data="url" data-toggle="modal">URL</a></li><li><a class="export" href="#open-export-modal" data="bbcode" data-toggle="modal">BBCode</a></li></ul></div><div id="open-export-modal" class="modal hide fade"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h5>Export</h5></div><div class="modal-body">Copy this and share:<br/><textarea id="export-textarea" class="field span12" wrap="off" rows="10"></textarea></div></div>')}return dust.register("buttonbar",t),t})(),function(){function t(t,e){return t.write('<div class="masthead"><ul class="nav nav-pills pull-right"><li class="active"><a href="#">Calculator</a></li><li><a href="https://github.com/joakibj/tswcalc" target="_blank">Github</a></li></ul><h2 class="muted">tswcalc</h2></div><hr><div class="row-fluid"><div class="span12">').partial("buttonbar",e,null).write('</div></div><hr/><div class="row-fluid"><div class="span8">').partial("slots",e,null).write('</div><div class="span4">').partial("summary",e,null).write('</div></div><hr><div class="footer"><p>tswcalc &copy; 2013 Joakim Bj&oslash;rnstad. Version <a href="https://github.com/joakibj/tswcalc/tree/1.1.1" target="_new">1.1.1</a>. Hosted on Github Pages.</p></div>')}return dust.register("container",t),t}(),function(){function t(t,i){return t.write("[size=3]Configuration Output[/size]\n\n[size=2]Summary[/size]\n\n").section(i.get("summary"),i,{block:e},null).write("\n\n[size=2]Gear report[/size]\n\n[size=-1]").section(i.get("slotState"),i,{block:s},null).write("[/size]")}function e(t,e){return t.write("[size=-1]").section(e.get("primary"),e,{block:i},null).section(e.get("offensive_defensive"),e,{block:n},null).write("[/size]")}function i(t,e){return t.write("[b]Primary stats[/b]\n[indent]Hitpoints: [b]").reference(e.get("hitpoints"),e,"h").write("[/b][/indent]\n[indent]Combat Power: [b]").reference(e.get("combat-power"),e,"h").write("[/b][/indent]\n[indent]Attack Rating: [b]").reference(e.get("attack-rating"),e,"h").write("[/b][/indent]\n[indent]Weapon Power: [b]").reference(e.get("weapon-power"),e,"h").write("[/b][/indent]\n[indent]Heal Rating: [b]").reference(e.get("heal-rating"),e,"h").write("[/b][/indent]\n")}function n(t,e){return t.write("[b]Offensive stats[/b]\n[indent]Critical Rating: [b][color=green]").reference(e.get("critical-rating"),e,"h").write("[/color][/b][/indent]\n[indent]Critical Chance: [b][color=green]").reference(e.get("critical-chance"),e,"h").write(" %[/color][/b][/indent]\n[indent]Critical Power Rating: [b][color=green]").reference(e.get("critical-power"),e,"h").write("[/color][/b][/indent]\n[indent]Critical Power: [b][color=green]").reference(e.get("critical-power-percentage"),e,"h").write(" %[/color][/b][/indent]\n[indent]Penetration Rating: [b][color=green]").reference(e.get("penetration-rating"),e,"h").write("[/color][/b][/indent]\n[indent]Hit Rating: [b][color=green]").reference(e.get("hit-rating"),e,"h").write("[/color][/b][/indent]\n[b]Defensive stats[/b]\n[indent]Block Rating: [b][color=green]").reference(e.get("block-rating"),e,"h").write("[/color][/b][/indent]\n[indent]Defense Rating: [b][color=green]").reference(e.get("defense-rating"),e,"h").write("[/color][/b][/indent]\n[indent]Evade Rating: [b][color=green]").reference(e.get("evade-rating"),e,"h").write("[/color][/b][/indent]\n[indent]Physical Protection: [b][color=green]").reference(e.get("physical-protection"),e,"h").write("[/color][/b][/indent]\n[indent]Magical Protection: [b][color=green]").reference(e.get("magical-protection"),e,"h").write("[/color][/b][/indent]\n")}function s(t,e){return t.write("[b]").reference(e.get("name"),e,"h").write(" (").exists(e.get("is_item"),e,{"else":a,block:l},null).write(")[/b] ").exists(e.get("stat_type"),e,{block:o},null).write("\n[indent]Glyph (QL [color=purple]10.").reference(e.get("glyph_ql"),e,"h").write("[/color]): ").exists(e.get("primary_glyph"),e,{block:c},null).exists(e.get("secondary_glyph"),e,{block:d},null).write("[/indent]\n").exists(e.get("signet_name"),e,{block:p},null)}function a(t,e){return t.write("QL [color=purple]10.").reference(e.get("ql"),e,"h").write("[/color]").exists(e.get("role"),e,{block:r},null)}function r(t,e){return t.write(" ").reference(e.get("role"),e,"h")}function l(t,e){return t.reference(e.get("signet_name"),e,"h")}function o(t,e){return t.write("[b][color=green]+").reference(e.get("stat_value"),e,"h").write("[/color][/b] ").reference(e.get("stat_type"),e,"h")}function c(t,e){return t.reference(e.get("primary_glyph"),e,"h").write(" [b][color=green]+").reference(e.get("primary_value"),e,"h").write("[/color][/b] (").reference(e.get("primary_dist"),e,"h").write("/4)")}function d(t,e){return t.write(" , ").reference(e.get("secondary_glyph"),e,"h").write(" [b][color=green]+").reference(e.get("secondary_value"),e,"h").write("[/color][/b] (").reference(e.get("secondary_dist"),e,"h").write("/4)")}function p(t,e){return t.write("[indent]Signet ([color=").reference(e.get("signet_colour"),e,"h").write("]").reference(e.get("signet_quality"),e,"h").write("[/color]):").notexists(e.get("is_item"),e,{block:h},null).write(" ").reference(e.get("signet_description"),e,"h").write("[/indent]\n")}function h(t,e){return t.write(" Signet of [b]").reference(e.get("signet_name"),e,"h").write("[/b].")}return dust.register("export\bbcode",t),t}(),function(){function t(t,e){return t.write('<div id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist" class="btn-group glyphbuttons"><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn0" class="btn btn-mini btn-danger">0</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn1" class="btn btn-mini btn-danger">1</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn2" class="btn btn-mini btn-danger">2</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn3" class="btn btn-mini btn-danger">3</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn4" class="btn btn-mini btn-danger">4</button></div>')}return dust.register("glyphbuttons",t),t}(),function(){function t(t,e){return t.write('<select id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-ql" class="select-ql"  title="Please select QL"><option value="10.0">10.0</option><option value="10.1">10.1</option><option value="10.2">10.2</option><option value="10.3">10.3</option><option value="10.4">10.4</option><option value="10.5">10.5</option></select>')}return dust.register("qlselect",t),t}(),function(){function t(t,n){return t.section(n.get("slots"),n,{"else":e,block:i},null)}function e(t){return t.write("<p>No slots found (Bug)!</p>")}function i(t,e){return t.write('<div id="').reference(e.get("id_prefix"),e,"h").write('-slot" class="slot"><h4 class="slot">').reference(e.get("name"),e,"h").write('</h4> <h4 id="').reference(e.get("id_prefix"),e,"h").write('-name" class="slot-name"></h4><table class="table table-slots"><tr>').notexists(e.get("is_weapon"),e,{block:n},null).write('<td class="ql-label"><strong>QL:</strong></td><td class="ql-select">').partial("qlselect",e,{id_suffix:""}).write("</td>").notexists(e.get("is_weapon"),e,{block:s},null).write('<td class="filler"></td></tr></table><div><table id="').reference(e.get("id_prefix"),e,"h").write('-glyphs" class="table table-glyphs"><tr><td class="glyph-ql" rowspan="2"><a href="#" class="glyph-tooltip" data-toggle="tooltip" title="Glyph for the ').reference(e.get("name"),e,"h").write(' slot. Choose which QL and stats it will have in your build."><img src="assets/images/icons/glyph.png" alt="Glyph"/></a> ').partial("qlselect",e,{id_suffix:"-glyph"}).write("</td><td><strong>Primary Stat</strong></td><td>").partial("statselect",e,{id_suffix:"primary"}).write("</td><td><strong>Distribution:</strong> ").partial("glyphbuttons",e,{id_suffix:"-primary-glyph"}).write('</td><td id="').reference(e.get("id_prefix"),e,"h").write('-primary-glyph-value" class="statvalue">0</td></tr><tr><td><strong>Secondary Stat</strong></td><td>').partial("statselect",e,{id_suffix:"secondary"}).write("</td><td><strong>Distribution:</strong> ").partial("glyphbuttons",e,{id_suffix:"-secondary-glyph"}).write('</td><td id="').reference(e.get("id_prefix"),e,"h").write('-secondary-glyph-value" class="statvalue">0</td></tr></table></div><div><table id="').reference(e.get("id_prefix"),e,"h").write('-signets" class="table table-signets"><tr><td><a href="#" class="signet-tooltip" data-toggle="tooltip" title="Signet for the ').reference(e.get("name"),e,"h").write(' slot. Choose the quality and type of signet."><img id="').reference(e.get("id_prefix"),e,"h").write('-signet-img-quality" class="signet-quality" src="assets/images/icons/normal.png"/><img id="').reference(e.get("id_prefix"),e,"h").write('-signet-img-icon" class="signet" src="assets/images/icons/minor_dps.png"/></a></td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-signet-quality"  title="Please select signet quality"><option value="none" selected="true">Quality</option><option value="normal">Normal</option><option value="elite">Elite</option><option value="epic">Epic</option></select></td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-pick-signet" title="Please select signet"></select></td><td id="').reference(e.get("id_prefix"),e,"h").write('-signet-description" class="signet-description"></td></tr></table></div></div>  ')
}function n(t,e){return t.write('<td class="role-label"><strong>Role: </strong></td><td class="role-select"><select id="').reference(e.get("id_prefix"),e,"h").write('-role" class="select-role" title="Please select role"><option value="none" selected="true">None</option><option value="dps">DPS</option><option value="tank">Tank</option><option value="healer">Healer</option></select></td>')}function s(t,e){return t.write('<td><label class="checkbox inline"><input type="checkbox" id="').reference(e.get("id_prefix"),e,"h").write('-nyraid" value="nyraid" disabled="disabled">NY Raid</label></td>')}return dust.register("slots",t),t}(),function(){function t(t,e){return t.write('<select id="').reference(e.get("id_prefix"),e,"h").write("-").reference(e.get("id_suffix"),e,"h").write('-glyph" class="select-glyph"  title="Please select stat"><option value="none" selected="true">None</option><option value="critical-rating">Critical Rating</option><option value="critical-power">Critical Power</option><option value="penetration-rating">Penetration Rating</option><option value="hit-rating">Hit Rating</option><option value="block-rating">Block Rating</option><option value="defense-rating">Defense Rating</option><option value="evade-rating">Evade Rating</option><option value="physical-protection">Physical Protection</option><option value="magical-protection">Magical Protection</option></select>')}return dust.register("statselect",t),t}(),function(){function t(t){return t.write('        <div id="summary"><h4>Summary</h4><div id="table-primary"><div class="row-fluid"><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Black Bullions drop from nightmare dungeon bosses."><img src="assets/images/icons/black_bullion.png" alt="Black Bullion"/></a> <span id="bb-cost">0</span></span><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Criterion Upgrades drop from the Unutterable Lurker in the Manhattan Exclusion Zone. Use with a nightwatch weapon/talisman toolkit to create 10.5 gear."><img src="assets/images/icons/criterion_upgrade.png" alt="Criterion Upgrade"/></a> <span id="cu-cost">0</span></span><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Astral Fuses drop from the Unutterable Lurker in the Manhattan Exclusion Zone. Use with a nightwatch glyph toolkit to create 10.5 glyphs."><img src="assets/images/icons/astral_fuse.png" alt="Astral Fuse"/></a> <span id="af-cost">0</span></span></div><table class="table table-stats"><thead><th>Primary Stat</th><th>Value</th></thead><tbody><tr><td class="statname">Hitpoints</td><td id="stat-hitpoints" class="statvalue">1970</td></tr><tr><td class="statname">Combat Power</td><td id="stat-combat-power" class="statvalue">0</td></tr><tr><td class="statname">Attack Rating</td><td id="stat-attack-rating" class="statvalue">0</td></tr><tr><td class="statname">Weapon Power</td><td id="stat-weapon-power" class="statvalue">0</td></tr><tr><td class="statname">Heal Rating</td><td id="stat-heal-rating" class="statvalue">0</td></tr></tbody></table></div><div id="table-offensive"><table class="table table-stats"><thead><th>Offensive Stat</th><th>Value</th></thead><tbody><tr><td class="statname">Critical Rating</td><td id="stat-critical-rating" class="statvalue">0 %</td></tr><tr><td class="statname">Critical Chance %</td><td id="stat-critical-chance" class="statvalue">0</td></tr><tr><td class="statname">Critical Power Rating</td><td id="stat-critical-power" class="statvalue">0</td></tr><tr><td class="statname">Critical Power</td><td id="stat-critical-power-percentage" class="statvalue">0 %</td></tr><tr><td class="statname">Penetration Rating</td><td id="stat-penetration-rating" class="statvalue">0</td></tr><tr><td class="statname">Hit Rating</td><td id="stat-hit-rating" class="statvalue">0</td></tr></tbody></table></div><div id="table-defensive"><table class="table table-stats"><thead><th>Defensive Stat</th><th>Value</th></thead><tbody><tr><td class="statname">Block Rating</td><td id="stat-block-rating" class="statvalue">0</td></tr><tr><td class="statname">Defense Rating</td><td id="stat-defense-rating" class="statvalue">0</td></tr><tr><td class="statname">Evade Rating</td><td id="stat-evade-rating" class="statvalue">0</td></tr><tr><td class="statname">Physical Protection</td><td id="stat-physical-protection" class="statvalue">249</td></tr><tr><td class="statname">Magical Protection</td><td id="stat-magical-protection" class="statvalue">249</td></tr></tbody></table></div><div id="raid-stats"><h5>Raid items</h5><label class="checkbox inline" data-toggle="tooltip" title="Activate bonuses from NY raid items, if they have a bonus applicable to the summary sheet. The bonus counts as you had procced all NY Raid items simultaneously or instantly got 10 stacks of the effect."><input type="checkbox" id="summary-activate-raid">Activate NY Raid items</label></div></div>')}return dust.register("summary",t),t}();var buttonHandler={},selectHandler={},raidCheckboxes={},buttonBar=0,summary=0,exportModule=0,importModule=0;$(document).ready(function(){initiateTswCalc()});var slots={init:function(){for(var t=0;template_data.slots.length>t;t++){var e=template_data.slots[t];this[e.id_prefix]=new Slot(e.id_prefix,e.name,e.group)}},length:function(){return template_data.slots.length},hasSlot:function(t){return this.hasOwnProperty(t)&&-1!=$.inArray(t,["head","weapon","ring","neck","wrist","luck","waist","occult"])},reset:function(){for(var t in this)this.hasSlot(t)&&this[t].reset()},state:function(){var t={};for(var e in this)this.hasSlot(e)&&(t[e]=this[e].state());return t},mappedState:function(){var t={};for(var e in this)this.hasSlot(e)&&(t[e]=this[e].mappedState());return t}};