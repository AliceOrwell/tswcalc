/*! tswcalc 2013-05-18 */
function renderContainer(){dust.render("container",template_data,function(t,e){t&&console.log(t),$(".container").html(e)})}function checkIfExported(){var t=$.getUrlVars();$.isEmptyObject(t)||8!=Object.keys(t).length||importModule.start(t)}function startSubModules(){for(var t=0;template_data.slots.length>t;t++)startDistributionButtonHandler(template_data.slots[t].id_prefix),startSelectHandler(template_data.slots[t].id_prefix);startButtonBar(),startSummary(),startExportModule(),startImportModule()}function addHash(){""==location.hash&&(location.hash=" ")}function startDistributionButtonHandler(t){buttonHandler[t]=new DistributionButtonHandler(t),buttonHandler[t].initiate()}function startSelectHandler(t){selectHandler[t]=new SelectHandler(t),selectHandler[t].initiate()}function startButtonBar(){buttonBar=new ButtonBar,buttonBar.initiate()}function startSummary(){summary=new Summary}function startExportModule(){exportModule=new Export,exportModule.initiate()}function startImportModule(){importModule=new Import}function Summary(){self=this,this.updateAllStats=function(){self.updatePrimaryStats(),self.updateOffensiveDefensiveStats()},this.updatePrimaryStats=function(){for(var t=1970,e=0,a=0,i=0;template_data.slots.length>i;i++){var n=$("#"+template_data.slots[i].id_prefix+"-role option:selected").attr("value"),l=$("#"+template_data.slots[i].id_prefix+"-ql option:selected").attr("value");"dps"==n?e+=custom_gear_data[template_data.slots[i].group].heal_dps["ql"+l].rating:"healer"==n?a+=custom_gear_data[template_data.slots[i].group].heal_dps["ql"+l].rating:"tank"==n&&(t+=custom_gear_data[template_data.slots[i].group].tank["ql"+l].hitpoints)}$("#stat-hitpoints").text(t),$("#stat-attack-rating").text(e),$("#stat-heal-rating").text(a)},this.updateOffensiveDefensiveStats=function(){for(var t={"critical-rating":0,"critical-power":0,"penetration-rating":0,"hit-rating":0,"block-rating":0,"defense-rating":0,"evade-rating":0,"physical-protection":249,"magical-protection":249},e=0;template_data.slots.length>e;e++){var a=$("#"+template_data.slots[e].id_prefix+"-glyph-ql option:selected").attr("value"),i=$("#"+template_data.slots[e].id_prefix+"-primary-glyph option:selected").attr("value"),n=$("#"+template_data.slots[e].id_prefix+"-secondary-glyph option:selected").attr("value");if("none"!=i||"none"!=n){var l=$("#"+template_data.slots[e].id_prefix+"-primary-glyph-dist > button.btn.active")[0].innerHTML,r=$("#"+template_data.slots[e].id_prefix+"-secondary-glyph-dist > button.btn.active")[0].innerHTML;if(null!=l||null!=r){var o=0,s=0;"none"!=i?(o=glyph_data.stat[i].ql[a].slot[template_data.slots[e].group].dist[l],t[i]+=o,$("#"+template_data.slots[e].id_prefix+"-primary-glyph-value").html("+"+o)):$("#"+template_data.slots[e].id_prefix+"-primary-glyph-value").html("0"),"none"!=n?(s=glyph_data.stat[n].ql[a].slot[template_data.slots[e].group].dist[r],t[n]+=s,$("#"+template_data.slots[e].id_prefix+"-secondary-glyph-value").html("+"+s)):$("#"+template_data.slots[e].id_prefix+"-secondary-glyph-value").html("0")}}else $("#"+template_data.slots[e].id_prefix+"-primary-glyph-value").html("0"),$("#"+template_data.slots[e].id_prefix+"-secondary-glyph-value").html("0")}self.updateStats(t)},this.updateStats=function(t){for(var e in t)t.hasOwnProperty(e)&&(t[e]>0?$("#stat-"+e).html("+"+t[e]):$("#stat-"+e).html("0"))}}function SelectHandler(t){var t=t,e=this;this.initiate=function(){e.addListenersToRoleSelect(t),e.addListenersToQlSelect(t,""),e.addListenersToGlyphSelect(t,"glyph-ql"),e.addListenersToGlyphSelect(t,"primary-glyph"),e.addListenersToGlyphSelect(t,"secondary-glyph")},this.addListenersToRoleSelect=function(t){$("#"+t+"-role").change(function(){summary.updatePrimaryStats()})},this.addListenersToQlSelect=function(t,e){$("#"+t+e+"-ql").change(function(){summary.updatePrimaryStats()})},this.addListenersToGlyphSelect=function(t,e){$("#"+t+"-"+e).change(function(){summary.updateOffensiveDefensiveStats()})}}function DistributionButtonHandler(t){var t=t,e=this;this.initiate=function(){this.addListenersToGlyphDistButtons(t,"primary-glyph"),this.addListenersToGlyphDistButtons(t,"secondary-glyph")},this.addListenersToGlyphDistButtons=function(a,i){e.onlyActiveButton("#"+t+"-primary-glyph-dist-btn0"),e.onlyActiveButton("#"+t+"-secondary-glyph-dist-btn0"),$("#"+a+"-"+i+"-dist > button.btn").on("click",function(){e.onlyActiveButton("#"+this.id),e.balanceGlyphDist(this,i),summary.updateOffensiveDefensiveStats()})},this.balanceGlyphDist=function(a,i){otherActiveButton=e.getActiveDist(t,e.getInverseGlyphStat(i)),e.balanceGlyphDistOverflow(a,otherActiveButton)},this.getActiveDist=function(t,e){return $("#"+t+"-"+e+"-dist > button.btn.active")[0]},this.balanceGlyphDistOverflow=function(t,a){if(null!=a){var i=parseInt(t.innerHTML),n=parseInt(a.innerHTML),l=i+n;if(l>4){var r=a.id.substring(0,a.id.length-1)+(n-(l-4));e.onlyActiveButton("#"+r)}}},this.onlyActiveButton=function(t){$(t).siblings().removeClass("active"),$(t).siblings().removeClass("btn-success"),$(t).addClass("active"),$(t).addClass("btn-success")},this.getInverseGlyphStat=function(t){return"primary-glyph"==t?"secondary-glyph":"primary-glyph"}}function ButtonBar(){var t=this;this.initiate=function(){t.resetButton(),t.addAllRoleListenerToButton("dps"),t.addAllRoleListenerToButton("healer"),t.addAllRoleListenerToButton("tank"),t.addAllQlListenerToButton("10.4"),t.addAllQlListenerToButton("10.5")},this.addAllRoleListenerToButton=function(e){$("#btn-all-"+e).on("click",function(){for(var a=0;template_data.slots.length>a;a++)t.setRoleOnSlot(e,template_data.slots[a].id_prefix);summary.updateAllStats()})},this.setRoleOnSlot=function(t,e){$("#"+e+"-role").val(t)},this.addAllQlListenerToButton=function(e){qlid=e.replace(".","-"),$("#btn-all-"+qlid).on("click",function(){for(var a=0;template_data.slots.length>a;a++)t.setQlOnSlot(e,template_data.slots[a].id_prefix),t.setGlyphQlOnSlot(e,template_data.slots[a].id_prefix);summary.updateAllStats()})},this.setQlOnSlot=function(t,e){$("#"+e+"-ql").val(t)},this.setGlyphQlOnSlot=function(t,e){$("#"+e+"-glyph-ql").val(t),$("#"+e+"-primary-glyph-dist-btn4").trigger("click")},this.resetButton=function(){$("#btn-reset").on("click",function(){for(var e=0;template_data.slots.length>e;e++)t.resetAllInput(template_data.slots[e].id_prefix);summary.updateAllStats()})},this.resetAllInput=function(t){$("#"+t+"-ql").val("10.0"),$("#"+t+"-role").val("none"),$("#"+t+"-glyph-ql").val("10.0"),$("#"+t+"-primary-glyph").val("none"),$("#"+t+"-secondary-glyph").val("none"),$("#"+t+"-primary-glyph-dist-btn0").trigger("click"),$("#"+t+"-secondary-glyph-dist-btn0").trigger("click")}}function Export(){var t=this;this.initiate=function(){$("a.export").on("click",function(e){t.exportType=$(e.target).attr("data"),t.startExport()}),$("#open-export-modal").on("shown",function(){$("#export-textarea").focus()}),$("#export-textarea").focus(function(){$(this).select(),$(this).mouseup(function(){return $(this).unbind("mouseup"),!1})})},this.startExport=function(){"url"==t.exportType&&this.startExportUrl()},this.startExportUrl=function(){var t=this.collectAllSlotStates();console.log(t),$("#export-textarea").html(window.location.href+t)},this.collectAllSlotStates=function(){for(var t="",e=0;template_data.slots.length>e;e++)t+=this.collectSlotState(template_data.slots[e].id_prefix),template_data.slots.length-1>e&&(t+="&");return t},this.collectSlotState=function(e){for(var a=e+"=",i=["-ql","-role","-glyph-ql","-primary-glyph","-secondary-glyph"],n=0;i.length>n;n++){var l=$("#"+e+i[n]).val();(null==l||"none"==l)&&(l=0),a+=t.stripContent(l),a+=","}return a+=buttonHandler[e].getActiveDist(e,"primary-glyph").innerHTML+",",a+=buttonHandler[e].getActiveDist(e,"secondary-glyph").innerHTML},this.stripContent=function(t){var e=/\d+\.\d/;return 0!=t&&t.match(e)?t.split(".")[1]:-1!=$.inArray(t,Object.keys(stat_mapping.to_num))?stat_mapping.to_num[t]:-1!=$.inArray(t,Object.keys(role_mapping.to_num))?role_mapping.to_num[t]:t}}function Import(){this.start=function(t){for(var e in t)t.hasOwnProperty(e)&&(splitVars=t[e].split(","),this.setValues(e,splitVars))},this.setValues=function(t,e){$("#"+t+"-ql").val("10."+e[0]),$("#"+t+"-role").val(role_mapping.to_stat[e[1]]),$("#"+t+"-glyph-ql").val("10."+e[2]),$("#"+t+"-primary-glyph").val(stat_mapping.to_stat[e[3]]),$("#"+t+"-secondary-glyph").val(stat_mapping.to_stat[e[4]]),$("#"+t+"-primary-glyph-dist-btn"+e[5]).trigger("click"),$("#"+t+"-secondary-glyph-dist-btn"+e[6]).trigger("click"),summary.updateAllStats()}}(function(){function t(t){return t.write('<div class="btn-group"><button id="btn-reset" class="btn btn-danger">Reset</button></div><div class="btn-group"><button id="btn-all-dps" class="btn">All DPS</button><button id="btn-all-healer" class="btn">All Healer</button><button id="btn-all-tank" class="btn">All Tank</button></div><div class="btn-group"><button id="btn-all-10-4" class="btn">All 10.4</button><button id="btn-all-10-5" class="btn">All 10.5</button></div><div class="btn-group"><a class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="#">Export<span class="caret"></span></a><ul class="dropdown-menu"><li><a class="export" href="#open-export-modal" data="url" data-toggle="modal">URL</a></li></ul></div><div id="open-export-modal" class="modal hide fade"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h5>Export</h5></div><div class="modal-body">Copy this and share:<br/><textarea id="export-textarea" wrap="off" rows="1"></textarea></div></div>')}return dust.register("buttonbar",t),t})(),function(){function t(t,e){return t.write('<div class="masthead"><ul class="nav nav-pills pull-right"><li class="active"><a href="#">Calculator</a></li><li><a href="https://github.com/joakibj/tswcalc">Github</a></li></ul><h2 class="muted">tswcalc</h2></div><hr><div class="row-fluid"><div class="span12">').partial("buttonbar",e,null).write('</div></div><hr/><div class="row-fluid"><div class="span8">').partial("slots",e,null).write('</div><div class="span4">').partial("summary",e,null).write('</div></div><hr><div class="footer"><p>&copy; 2013 Joakim Bj&oslash;rnstad. Hosted on Github Pages.</p></div>')}return dust.register("container",t),t}(),function(){function t(t,e){return t.write('<div id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist" class="btn-group glyphbuttons"><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn0" class="btn btn-mini btn-danger">0</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn1" class="btn btn-mini btn-danger">1</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn2" class="btn btn-mini btn-danger">2</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn3" class="btn btn-mini btn-danger">3</button><button id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-dist-btn4" class="btn btn-mini btn-danger">4</button></div>')}return dust.register("glyphbuttons",t),t}(),function(){function t(t,e){return t.write('<select id="').reference(e.get("id_prefix"),e,"h").reference(e.get("id_suffix"),e,"h").write('-ql" class="select-ql"><option value="10.0">10.0</option><option value="10.1">10.1</option><option value="10.2">10.2</option><option value="10.3">10.3</option><option value="10.4">10.4</option><option value="10.5">10.5</option></select>')}return dust.register("qlselect",t),t}(),function(){function t(t,i){return t.section(i.get("slots"),i,{"else":e,block:a},null)}function e(t){return t.write("<p>No slots found (Bug)!</p>")}function a(t,e){return t.write('<div id="').reference(e.get("id_prefix"),e,"h").write('-slot" class="slot"><h4 class="slot">').reference(e.get("name"),e,"h").write('</h4> <table class="table table-slots">').notexists(e.get("is_weapon"),e,{block:i},null).write("<tr><td><strong>QL:</strong></td><td>").partial("qlselect",e,{id_suffix:""}).write('</td></tr></table><div><table id="').reference(e.get("id_prefix"),e,"h").write('-glyphs" class="table table-glyphs"><tr><td><strong>Glyph QL</strong></td><td>').partial("qlselect",e,{id_suffix:"-glyph"}).write('</td></tr><tr><td>Glyph Primary Stat</td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-primary-glyph" class="select-glyph"><option value="none" selected="true">None</option><option value="critical-rating">Critical Rating</option><option value="critical-power">Critical Power</option><option value="penetration-rating">Penetration Rating</option><option value="hit-rating">Hit Rating</option><option value="block-rating">Block Rating</option><option value="defense-rating">Defense Rating</option><option value="evade-rating">Evade Rating</option><option value="physical-protection">Physical Protection</option><option value="magical-protection">Magical Protection</option></select></td><td><strong>Distribution:</strong> ').partial("glyphbuttons",e,{id_suffix:"-primary-glyph"}).write('</td><td id="').reference(e.get("id_prefix"),e,"h").write('-primary-glyph-value" class="statvalue">0</td></tr><tr><td>Glyph Secondary Stat</td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-secondary-glyph" class="select-glyph"><option value="none" selected="true">None</option><option value="critical-rating">Critical Rating</option><option value="critical-power">Critical Power</option><option value="penetration-rating">Penetration Rating</option><option value="hit-rating">Hit Rating</option><option value="block-rating">Block Rating</option><option value="defense-rating">Defense Rating</option><option value="evade-rating">Evade Rating</option><option value="physical-protection">Physical Protection</option><option value="magical-protection">Magical Protection</option></select></td><td><strong>Distribution:</strong> ').partial("glyphbuttons",e,{id_suffix:"-secondary-glyph"}).write('</td><td id="').reference(e.get("id_prefix"),e,"h").write('-secondary-glyph-value" class="statvalue">0</td></tr></table></div></div>  ')}function i(t,e){return t.write('<tr><td><strong>Role: </strong></td><td><select id="').reference(e.get("id_prefix"),e,"h").write('-role" class="select-role"><option value="none" selected="true">None</option><option value="dps">DPS</option><option value="tank">Tank</option><option value="healer">Healer</option></select></td></tr>')}return dust.register("slots",t),t}(),function(){function t(t){return t.write('        <div id="summary"><h4>Summary</h4><div id="table-primary"><table class="table table-stats"><thead><th>Primary Stat</th><th>Value</th></thead><tbody><tr><td>Hitpoints</td><td id="stat-hitpoints" class="statvalue">1970</td></tr><tr><td>Attack Rating</td><td id="stat-attack-rating" class="statvalue">0</td></tr><tr><td>Heal Rating</td><td id="stat-heal-rating" class="statvalue">0</td></tr></tbody></table></div><hr/><div id="table-offensive"><table class="table table-stats"><thead><th>Offensive Stat</th><th>Value</th></thead><tbody><tr><td>Critical Rating</td><td id="stat-critical-rating" class="statvalue">0</td></tr><tr><td>Critical Power</td><td id="stat-critical-power" class="statvalue">0</td></tr><tr><td>Penetration Rating</td><td id="stat-penetration-rating" class="statvalue">0</td></tr><tr><td>Hit Rating</td><td id="stat-hit-rating" class="statvalue">0</td></tr></tbody></table></div><hr/><div id="table-defensive"><table class="table table-stats"><thead><th>Defensive Stat</th><th>Value</th></thead><tbody><tr><td>Block Rating</td><td id="stat-block-rating" class="statvalue">0</td></tr><tr><td>Defense Rating</td><td id="stat-defense-rating" class="statvalue">0</td></tr><tr><td>Evade Rating</td><td id="stat-evade-rating" class="statvalue">0</td></tr><tr><td>Physical Protection</td><td id="stat-physical-protection" class="statvalue">249</td></tr><tr><td>Magical Protection</td><td id="stat-magical-protection" class="statvalue">249</td></tr></tbody></table></div></div>')}return dust.register("summary",t),t}();var buttonHandler={},selectHandler={},buttonBar=0,summary=0,exportModule=0,importModule=0;$(document).ready(function(){renderContainer(template_data),addHash(),startSubModules(),checkIfExported(),$("#summary").scrollToFixed()});